version: 1.0.{build}
image: Visual Studio 2022
configuration: Release
platform: Any CPU
environment:
  COVERALL_REPO_TOKEN:
    -secure: MWUFI8zEsgpEMW1l8HOlNkY6/9GjOwHzaySRk+sO3hTq33sOeHfFbNq0ZUzS9PVf
build_script:
  - pwsh: dotnet restore
  - pwsh: dotnet build -c Release
test_script:
  - pwsh: >-
      dotnet test -c Release /p:CollectCoverage=true  /p:CoverletOutput=../coverage/ /p:MergeWith="../CoverageResults/coverage.json" /p:CoverletOutputFormat="lcov%2cjson" -m:1


      dotnet new tool-manifest

      dotnet tool install coveralls.net

      dotnet tool restore

      dotnet tool run csmacnz.Coveralls --lcov -i ./tests/coverage/coverage.info --repoToken  $env:COVERALLS_REPO_TOKEN --commitId $env:APPVEYOR_REPO_COMMIT --commitBranch $env:APPVEYOR_REPO_BRANCH --commitAuthor $env:APPVEYOR_REPO_COMMIT_AUTHOR --commitEmail $env:APPVEYOR_REPO_COMMIT_AUTHOR_EMAIL --commitMessage $env:APPVEYOR_REPO_COMMIT_MESSAGE --jobId $env:APPVEYOR_JOB_ID
